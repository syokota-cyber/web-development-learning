# 学習重視開発ルール

## 🎓 開発方針
- **段階的実装**: 一度に全機能を作成せず、小さな単位で段階的に実装
- **理解確認**: コード生成前に必ず選択肢と理由を説明
- **実践重視**: 私が理解を確認するまで次のステップに進まない
- **学習優先**: 最適解より学習効果を重視

## 📋 実装プロセス
1. **技術選定相談**: 必ず3つの選択肢とメリット・デメリットを提示
2. **段階的実装**: 最小単位から始めて段階的に機能追加
3. **コード説明**: 実装後は必ずコードの意味と理由を説明
4. **理解確認**: 私の理解度を確認してから次の段階へ

## ❌ 禁止事項
- 一度に5行以上のコードを書くこと
- 新しい概念を導入前の説明なし
- エラーの直接修正（まず私に考えさせる）
- 最適化提案の一方的実施
- **古い情報・曖昧な説明**（最新の正確な情報を提供）
- **複数選択肢の説明不足**（必ず比較・選択理由を明示）
- **セキュリティ情報の軽率な扱い**（機密レベルの明確化必須）
- **本番環境への無断デプロイ**（Vercel等への勝手なデプロイ・プッシュは絶対禁止）
- **技術仕様の無断変更**（フレームワーク・ライブラリ等の変更は必ず事前承認）

## ✅ 必須確認事項
コード生成時は以下を必ず確認：
- 「なぜこの実装方法を選んだか理解できましたか？」
- 「他の方法との違いは分かりますか？」
- 「次に学ぶべき概念はありますか？」

### 🔒 セキュリティ情報の扱い（2025年8月4日追加）
設定・認証情報を扱う際は以下を徹底：
- **機密レベルの明確化**: 最高機密/中程度/公開情報を明示
- **最新情報の確認**: 古いドキュメントに基づく説明を避ける
- **選択肢の詳細説明**: Legacy/現行版の違いと推奨理由を説明
- **段階的セキュリティ学習**: 「なぜこの方法が安全か」から説明

### 📚 最新技術情報の確認（2025年8月4日追加）
新しいプラットフォーム・ツールを説明する際：
- **複数バージョンの存在確認**: Legacy版と最新版の違いを調査
- **公式ドキュメント基準**: 最新の公式情報を参照
- **UIの変更対応**: 画面構成の変更を考慮した説明
- **3つの選択肢提示**: 必ず代替案とメリット・デメリットを提示

### 🚨 技術仕様変更の承認ルール（2025年8月7日追加）
技術仕様に影響する変更は必ず事前承認が必要：

#### **必須承認事項:**
- ✋ **フレームワーク変更** (React→Vue、CRA→Vite、Next.js等)
- ✋ **ライブラリの大幅変更** (Supabase→Firebase、Axios→Fetch等)
- ✋ **ビルドツール変更** (Webpack→Rollup、Babel設定変更等)
- ✋ **言語・バージョン変更** (TypeScript導入、Node.js版変更等)
- ✋ **アーキテクチャ変更** (SPA→SSR、CSR→SSG等)
- ✋ **データベース・認証変更** (PostgreSQL→MongoDB等)

#### **事前確認が必要:**
- 📋 **依存関係の大幅更新** (メジャーバージョンアップ)
- 📋 **新しいツールの導入** (ESLint、Prettier、Testing Library等)
- 📋 **設定ファイルの大幅変更** (package.json、webpack.config等)

#### **承認不要（緊急対応のみ）:**
- ✅ バグ修正のための最小限の依存関係調整
- ✅ デプロイ設定の微調整(.npmrc、vercel.json等)
- ✅ 既存機能の改善・UI修正

#### **承認プロセス:**
技術仕様変更を検討する際は、以下の形式で選択肢を提示：

```
🔧 技術的課題: [問題の詳細]

解決方法の選択肢:
1. **現在の技術スタック維持**: [詳細・メリット・デメリット]
2. **最小限の調整**: [詳細・メリット・デメリット] 
3. **技術変更**: [詳細・メリット・デメリット]

推奨案: [理由]
どちらを選択されますか？
```

**🚫 承認なしの勝手な技術変更は絶対禁止**

## 🚨 データベース問題対応の鉄則（2025年8月11日追加）

### 「Migration First・調査ファースト・創作ラスト」原則
**重要な教訓**: 2025年8月11日のSupabase復旧作業で、Migration履歴を確認せずに勝手にテーブルを創作してしまい、大幅な時間ロスが発生。以下の鉄則を徹底する。

#### **データベース問題発生時の必須確認順序**
1. **`/supabase/migrations/` フォルダ**: 最優先で Migration履歴を確認
2. **`/supabase/seed.sql`**: 初期データの確認  
3. **`learning-logs/`**: 過去の作業記録・インシデント記録確認
4. **バックアップフォルダ**: `*-backup-*` フォルダの詳細調査
5. **`.md ドキュメント`**: 人間が読める自然言語での重要情報確認

#### **絶対禁止事項（データベース関連）**
- ❌ **Migration確認前のテーブル作成**: 推測による独自構造作成を絶対避ける
- ❌ **既存構造確認前の推測作業**: 「きっとこうだろう」による作業禁止
- ❌ **バックアップ調査を後回し**: 既存資産の調査を最優先にする
- ❌ **一般知識の優先**: プロジェクト固有の構造を一般的なDB知識より優先

#### **正しい思考プロセス**
```
❌ 間違い: エラー発生 → 「テーブルがない」 → 「作ればいい」 → 推測で作成
✅ 正しい: エラー発生 → 「なぜないのか？」 → Migration調査 → 正確な復元
```

#### **データベース作業時の必須チェックリスト**
- [ ] `/supabase/migrations/` フォルダの存在と内容確認
- [ ] Migration履歴からのテーブル定義とデータ型の把握
- [ ] 既存の外部キー制約とリレーション関係の理解
- [ ] バックアップファイルの関連情報（.md含む）の確認
- [ ] 段階的復旧での各ステップ動作確認（DROP→CREATE→INSERT→TEST）

### 📝 **人間可読ドキュメントの重要性**
**重要な発見**: `.md ファイル`や自然言語のドキュメントが復旧の鍵となった。SQLだけでなく、人間が理解しやすい形での情報記録が命拾いした。

#### **ドキュメント活用の教訓**
1. **Migration + Markdown**: SQLファイルと説明文書の併用で確実な復旧
2. **学習ログの価値**: 過去のインシデント記録が問題解決の手がかり
3. **バックアップの多様性**: コードだけでなく、説明文書も重要な復旧資料
4. **自然言語での記録**: AIが理解しやすく、人間も振り返りやすい

#### **ドキュメント管理の新ルール**
- ✅ **Migration実行時**: 必ず対応する.mdファイルで説明記録
- ✅ **重要な変更時**: 技術的詳細と理由を自然言語で記録
- ✅ **インシデント発生時**: 原因・対処・教訓を詳細に文書化
- ✅ **構造変更時**: データベース設計の意図と関係性を明文化

## 🚨 メール送信・外部サービス連携の鉄則（2025年8月11日追加）

### 「実在確認ファースト・テスト環境分離・架空禁止」原則
**重大インシデント**: 2025年8月11日、AIが架空のメールアドレス（test@camping-car.com）を作成し、Supabaseのメール送信制限を引き起こした。以下を徹底する。

#### **メール送信機能実装時の必須確認事項**
1. **架空のメールアドレス・ドメインの使用禁止**
   - ❌ `test@example.com`、`user@test.com`、`admin@camping-car.com` 等
   - ✅ 実在する個人のメールアドレスまたは環境変数から取得
   - ✅ ローカル開発用のメールキャプチャツール（Mailpit等）

2. **テストアカウント作成時の必須ルール**
   ```javascript
   // ❌ 絶対禁止
   const testEmail = 'test@camping-car.com';  // 架空のドメイン
   
   // ✅ 正しい実装
   const testEmail = process.env.TEST_EMAIL || 'shin1yokota@gmail.com';  // 実在するメール
   ```

3. **開発環境でのメール送信設定**
   - Supabase CLIのMailpit活用（localhost:54324）
   - 本番環境移行前にカスタムSMTPプロバイダー設定
   - SendGrid、Mailgun、Amazon SES等の検討

#### **外部サービス連携時のリスク評価**
- **事前確認項目**:
  - [ ] APIレート制限の確認
  - [ ] テスト環境の分離方法
  - [ ] バウンス率・スパム判定のリスク
  - [ ] 課金・制限の影響範囲
  
- **実装前の必須作業**:
  - [ ] 公式ドキュメントの最新版確認
  - [ ] テスト用の正規アカウント準備
  - [ ] ロールバック手順の確立
  - [ ] 監視・アラート設定

#### **インシデント発生時の対応手順**
1. **即座に該当機能の無効化**
2. **影響範囲の特定と記録**
3. **サービスプロバイダーへの連絡**
4. **原因分析と再発防止策の文書化**
5. **CLAUDE.mdへの教訓追加**

#### **AIへの指示事項**
- 架空のデータ（メール、URL、ID等）を勝手に作成しない
- テストデータは必ず「これはテスト用です」と明示
- 外部サービス連携前に必ずリスク評価を提示
- 「試行錯誤」ではなく「1回で正確に」実装

## 📧 メール送信設定（2025年8月11日設定済み）

### 現在の設定状況
- **カスタムSMTP**: Resend設定済み（100通/日まで無料）
- **Supabaseプロジェクト**: rwxllvnuuxabvgxpeuma
- **送信元**: no-reply@camping-car.app
- **テスト用メール**: shin1yokota@gmail.com（実在）

### 開発時の必須確認
- ✅ カスタムSMTP（Resend）経由でメール送信される
- ✅ デフォルトSMTPは使用しない（制限中）
- ✅ 架空メールアドレスは絶対使用しない

## 🛠️ カスタムコマンド
- `/learn [概念]`: 指定概念の段階的学習開始
- `/explain [コード]`: コードの詳細解説
- `/compare [技術A] [技術B]`: 技術比較と使い分け説明
- `/review`: 学習進捗確認と理解度テスト
- `/hands-on [課題]`: 実践的な課題提供

## 📅 週次ルーチン
毎週以下を実施：
1. 学習内容の整理と振り返り
2. 理解度チェックテストの実施
3. 来週の学習目標設定
4. CLAUDE.mdの更新

## 🎯 学習目標例
- Web開発の基礎理解
- React/Vue.jsでのSPA構築
- API設計と実装
- データベース操作
- デプロイメント手順

## 📊 進捗管理
- 完了した概念: [HTML5基礎, CSS3スタイリング, JavaScript DOM操作, React基礎, Props, State, イベントハンドリング, リスト表示, フォーム処理, Git/GitHubバージョン管理, Create React App, Supabase統合]
- 進行中の概念: [Supabase認証問題解決, 本番環境デプロイメント]
- 次に学ぶ概念: [JWT認証の深い理解, Vercel環境変数管理, Node.js バックエンド開発]
- 復習が必要な概念: [Supabase API Keys管理, 環境変数設定]

## 🚨 **緊急課題 (2025年8月8日更新)**
### **カスタムスポット関連問題群 - 未解決**
- **問題1**: カスタム立ち寄りスポットのチェック状態が消失する
- **問題2**: カレンダーの達成度がレビュー値に反映されない  
- **問題3**: 星評価からパーセント表示への変更未反映
- **根本原因**: ID形式混在、達成度計算ロジック、キャッシュ問題
- **詳細ログ**: `URGENT_FIX_LOG_20250808.md`参照

### **本番環境情報**
- **URL**: https://travel-journal-ochre-two.vercel.app
- **状態**: 基本機能動作、UI/UX改善課題あり
- **Supabase Project**: rwxllvnuuxabvgxpeuma
- **開発環境**: http://localhost:3000 稼働中

## 🔗 GitHubリポジトリ情報
- **リポジトリURL**: https://github.com/syokota-cyber/web-development-learning
- **説明**: 🎓 React基礎から始める段階的Web開発学習リポジトリ - Claude Codeを使用した学習記録
- **アクセス**: パブリック
- **ローカルパス**: `/Users/syokota_mac/learning-projects/web-development`

### Git操作コマンド
```bash
# 変更をプッシュ
git add .
git commit -m "変更内容の説明"
git push

# 状況確認
git status
git log --oneline
```

## 📚 学習ログ管理

### 🚨 **作業開始時の必須確認（2025年8月10日改定）**
```bash
# 1. 必ず最新ログを確認（AIが確実に認識するため）
cat camping-car-apps/learning-logs/index.md

# 2. 今日のログファイルを確認または作成
ls camping-car-apps/learning-logs/$(date +%Y-%m-%d).md || \
  echo "本日のログファイルを作成してください"

# 3. 昨日のログを確認（重要な継続案件の把握）
cat camping-car-apps/learning-logs/$(date -v-1d +%Y-%m-%d).md 2>/dev/null || \
  echo "昨日のログなし"
```

### ⚠️ **ログファイル命名規則（厳守）**
- **形式**: `YYYY-MM-DD.md`（例: 2025-08-10.md）
- **配置**: `camping-car-apps/learning-logs/` 直下（階層構造禁止）
- **理由**: AIが確実に日付順で認識できる最もシンプルな構造

### 📝 日別学習記録の管理
```bash
# 新規ログ作成（プロジェクトルートから実行）
echo "# 📚 学習ログ - $(date +%Y年%m月%d日)" > \
  camping-car-apps/learning-logs/$(date +%Y-%m-%d).md

# 最新ログを開く
open camping-car-apps/learning-logs/$(date +%Y-%m-%d).md

# 過去7日分のログを確認
for i in {0..6}; do
  date -v-${i}d +%Y-%m-%d
done | xargs -I {} ls camping-car-apps/learning-logs/{}.md 2>/dev/null
```

### 🔍 重要ログの確認
```bash
# インシデントログの確認（必読）
cat camping-car-apps/learning-logs/2025-08-09.md  # Supabase制限事故

# 索引から最新状況を把握
cat camping-car-apps/learning-logs/index.md
```

### 📊 ログ構成
- `learning-logs/index.md` - 索引（最新状況と重要ログへのリンク）
- `learning-logs/YYYY-MM-DD.md` - 日別ログ（作業記録）
- `learning-logs/2025-08-09.md` - ⚠️ 重大インシデント記録（永久保存）

### ❌ **廃止された旧構造（使用禁止）**
- ~~`learning-logs/2025/08/YYYY-MM-DD.md`~~ - 階層構造は認識困難
- ~~`learning-logs/log-template.md`~~ - テンプレート不要、直接作成

## 🔄 学習再開方法
1. `cd ~/learning-projects/web-development`
2. `claude` で Claude Code を起動
3. **前回の学習ログを確認**: `open learning-logs/index.md`
4. `/learn "React基礎"` または `/learn "Node.js基礎"` で再開
5. 完成したポートフォリオを確認: `open profile.html`
6. **学習ログを更新**: 本日の学習内容を記録
7. 学習成果をGitにコミット: `git add . && git commit -m "学習内容" && git push`

## 💡 学習のコツ
- 完璧を求めず段階的に進める
- エラーを恐れずに実際にコードを書く
- 分からないことは遠慮なく質問する
- 他の実装方法も積極的に学ぶ
- **学習成果は必ずGitでバージョン管理する**
